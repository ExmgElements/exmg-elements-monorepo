<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>exmg-data-connection</title>

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>

    <link rel="import" href="../../paper-card/paper-card.html">

    <link rel="import" href="../exmg-data-connection-config.html">
    <link rel="import" href="../exmg-data-connection.html">
  </head>
  <body>
    <dom-module id="data-connection-demo">
      <template>

        <h1>Exmg Data Connection Element</h1>
        <paper-card heading="Response Swagger call">
          <div class="card-content">
            <template is="dom-if" if="[[error]]">
              Error: [[error]]
            </template>
            <template is="dom-if" if="[[data]]">
              data: [[data]]
            </template>
          </div>
        </paper-card>

        <!-- Initialize swagger client api -->
        <exmg-data-connection-config
          swagger-url="data/swagger.json"
          server-url="https://backend.winview-dev-feature.playtotv.com/"
          api-ready="{{apiReady}}"
        ></exmg-data-connection-config>

        <!-- Create call to globalData.get -->
        <template is="dom-if" if="[[apiReady]]" restamp="true">
          <exmg-data-connection
            resource="globalData"
            method="get"
            last-error="{{error}}"
            last-response="{{data}}"
            auto></exmg-data-connection>
        </template>

        <exmg-data-connection
          id="connection"
          resource="gatekeeper"
          method="getInit1"
          last-error="{{error}}"
          last-response="{{data}}"></exmg-data-connection>

      </template>
      <script>
        window.addEventListener('WebComponentsReady', function() {
          class DataConnectionDemo extends Polymer.Element {
            static get is() { return 'data-connection-demo'; }
            static get properties() {
              return {
                apiReady: {
                  type: Boolean,
                  observer: '_apiReady',
                },
              };
            }
            _apiReady() {
              if(Exmg.DataConnectionConfig) {
                console.log('Exmg.DataConnectionConfig.apis', Exmg.DataConnectionConfig);
                this.$.connection.generateRequest().then((response) => {
                  console.log('gatekeeper.getInit1', response);
                }).catch((e) => {
                  console.error('gatekeeper.getInit1', e);
                });
              }
            }
          }
          window.customElements.define(DataConnectionDemo.is, DataConnectionDemo);
        });
      </script>
    </dom-module>

    <data-connection-demo></data-connection-demo>
  </body>
</html>
