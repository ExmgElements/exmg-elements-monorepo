<link rel="import" href="../polymer/polymer-element.html">

<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-icon/iron-icon.html">

<!--
`exmg-cms-sidemenu` displays a vertical sidemenu that can be collapsed.

### Menu data model
Menu items need to have the following structure:
```js
{
  "path": "user/", // Path for href and selection
  "icon": "dev-icons:people", // Icon that needs to be pre-loaded
  "title": "Users" // Copy to display
}
```

Grouping menu items will be done in the following structure:
```js
{
  "title": "Users",
  "items": [
    {
      "path": "user/",
      "icon": "dev-icons:people",
      "title": "Users"
    },
    {
      "path": "redeem/",
      "icon": "dev-icons:attach-money",
      "title": "Redeem Requests"
    },
    {
      "path": "reporteduser/",
      "icon": "dev-icons:feedback",
      "title": "Reported Users"
    }
  ]
}
```

-->
<dom-module id="exmg-cms-sidemenu">
  <template>
    <style>
      :host {
        color: #747574;
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        background: #fff;
        transition: all 0.3s ease;
        @apply(--layout-flex);
        @apply(--layout-vertical);
      }

      .nav-heading {
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        padding: 0 14px;
        overflow: hidden;
        cursor: default;
        -webkit-user-select: none;
        font-size: 12px;
        height: 2.5rem;
        line-height: 3rem;
        letter-spacing: .5px;
        text-transform: uppercase;
        color: #999;
      }

      .menu-item {
        text-decoration: none;
        outline: none;
      }

      paper-listbox {
        border-top: 1px solid #ddd;
        background: none;
      }

      paper-item {
        height: 2rem;
        min-height: auto;
        box-sizing: border-box;
        margin: 0;
        overflow: visible;
        width: 100%;
        font-size: 14px;
        font-weight: 500;
        color: #747574;
        text-align: start;
        cursor: pointer;
      }

      paper-item > iron-icon {
        padding-right: 1rem;
      }

      .menu-header {
        background: #F9FAF9;
        min-height: 3.5rem;
        @apply(--layout);
        @apply(--layout-center);
      }

      .menu-header paper-listbox {
        @apply(--layout);
        width: 100%;
        border: none;
      }

      .menu-header .menu-item:first-child {
        border-right: 1px solid #ddd;
        @apply(--layout-flex);
      }

      .menu-header paper-item {
        padding-right: 0;
      }

      .menu-body {
        @apply(--layout-flex);
        overflow: auto;
      }

      .menu-footer paper-icon-button {
        transition: transform .1s linear;
        transform: rotate(0deg);
        @apply(--layout-end-justified);
      }

      .menu-footer {
        border-top: 1px solid #ddd;
        background: #F9FAF9;
        min-height: 3rem;
        @apply(--layout);
        @apply(--layout-end-justified);
        @apply(--layout-center);
      }
      .menu-footer paper-icon-button {
        margin: 0 4px;
        color: #747574;
      }

      :host([collapsed]) .menu-footer {
        @apply(--layout);
        @apply(--layout-center-justified);
        @apply(--layout-center);
      }

      :host([collapsed]) paper-item > iron-icon { padding: 0; }
      :host([collapsed]) paper-item > span { display: none; }
      :host([collapsed]) .nav-heading { display: none; }
      :host([collapsed]) .menu-header paper-listbox {
        border-bottom: 0;
        padding: 5px 0;
      }
      :host([collapsed]) paper-listbox {
        padding: 5px 0;
      }

      :host([collapsed]) .menu-header {
        @apply(--layout-vertical);
      }

      :host([collapsed]) .menu-header paper-listbox {
        @apply(--layout-vertical);
        border-right: 0px;
      }

      :host([collapsed]) .menu-header .menu-item { border-right: none; }

      :host([collapsed]) paper-item { height: 2.5rem; }

      :host([collapsed]) .menu-footer paper-icon-button { transform: rotate(180deg); }

      a[aria-selected] paper-item {
        color: #0099E9;
      }

      span.badge {
        font-size: 11px;
        border-radius: 12px;
        margin-left: 0px;
        margin-bottom: 0px;
        padding: 2px 6px;
        height: 20px;
        background-color: #46B614;
        color: white;
        margin-left: .5rem;
      }
      span.icon-badge {
        display:none;
        font-size: 11px;
        border-radius: 12px;
        margin-left: 0px;
        margin-bottom: 0px;
        background-color: #46B614;
        color: white;
        margin-left: 4px;
        position: absolute;
        left: 30px;
        top: 0px;
        line-height: 16px;
        padding: 1px 4px;
      }
      :host([collapsed]) paper-item span.icon-badge {
        display: block;
      }

    </style>

    <!-- Sidemenu Header -->
    <div class="menu-header">
      <paper-listbox attr-for-selected="data-path" selected="{{selected}}" selectable="a">
        <a href="[[_getHref('/')]]" data-path="/" tabindex="-1" class="menu-item">
          <paper-item role="menuitem">
            <iron-icon icon="dev-icons:dashboard"></iron-icon>
            <span>Dashboard</span>
          </paper-item>
        </a>
        <a href="[[_getHref('settings/')]]" data-path="settings/" tabindex="-1" class="menu-item">
          <paper-item role="menuitem">
            <iron-icon icon="dev-icons:settings"></iron-icon>
          </paper-item>
        </a>
      </paper-listbox>
    </div>

    <!-- Sidemenu body -->
    <div class="menu-body" role="navigation">

      <!-- Menu Items -->
      <paper-listbox attr-for-selected="data-path" selected="{{selected}}" selectable="a">
        <template is="dom-repeat" items="[[menu]]" as="item">
          <template is="dom-if" if="[[!_hasItems(item)]]">
            <a href="[[_getHref(item.path)]]" data-path$="[[item.path]]" tabindex="-1" class="menu-item">
              <paper-item data-path$="[[item.path]]" role="menuitem">
                <iron-icon icon="[[item.icon]]"></iron-icon>
                <span>[[item.title]]</span>
              </paper-item>
            </a>
          </template>
          <template is="dom-if" if="[[_hasItems(item)]]">
            <div class="nav-heading">[[item.title]]</div>
            <template is="dom-repeat" items="[[item.items]]" as="subitem">
              <a href="[[_getHref(subitem.path)]]" data-path$="[[subitem.path]]" tabindex="-1" class="menu-item">
                <paper-item data-path$="[[subitem.path]]" class$="[[_hasClassBadge(subitem)]]" role="menuitem">
                  <iron-icon icon="[[subitem.icon]]"></iron-icon>
                  <template is="dom-if" if="[[subitem.badge]]">
                  	<span class="icon-badge">[[_computeBadgeCount(subitem)]]</span>
                  </template>
                  <span class="title">[[subitem.title]]<template is="dom-if" if="[[subitem.badge]]"><span class="badge">[[subitem.badgeCount]]</span></template></span>
                </paper-item>
              </a>
            </template>
          </template>
        </template>
      </paper-listbox>
    </div>

    <!-- Sidemenu Footer -->
    <div class="menu-footer">
      <paper-icon-button id="mode-button" icon="dev-icons:chevron-left" on-tap="_handleCollapse"></paper-icon-button>
    </div>
  </template>

  <script>
    /**
     * `exmg-cms-sidemenu`
     * Collapsible side menu for CMS projects
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class ExmgCmsSidemenu extends Polymer.Element {
      static get is() { return 'exmg-cms-sidemenu'; }
      static get properties() {
        return {
          /*
          * Disables actual href links
          */
          debug: {
            type: Boolean,
            value: false,
          },
          /*
          * For selection you can use the path value
          */
          selected: {
            type: String,
          },
          /*
          * For selection you can use the path value
          */
          menu: {
            type: Array,
          },
          collapsed: {
            type: Boolean,
            notify: true,
            reflectToAttribute: true,
            value: false,
          },
        };
      }
      _getHref(path) {
        return this.debug ? '#' : path;
      }
      _hasItems(item) {
        return item.items;
      }
      _hasClassBadge(item) {
        return item.badgeCount ? 'badge' : '';
      }
      _computeBadgeCount(item) {
        return item.badgeCount > 99 ? '...' : item.badgeCount;
      }
      _handleCollapse() {
        this.set('collapsed', !this.collapsed);
      }

    }

    window.customElements.define(ExmgCmsSidemenu.is, ExmgCmsSidemenu);
  </script>
</dom-module>
