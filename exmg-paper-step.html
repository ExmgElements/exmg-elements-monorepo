<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../paper-ripple/paper-ripple.html">
<link rel="import" href="../paper-styles/paper-styles.html">
<link rel="import" href="../polymer/lib/mixins/gesture-event-listeners.html">

<link rel="import" href="exmg-paper-stepper-icons.html">

<dom-module id="exmg-paper-step">
  <template>
    <style>
      :host {
        display: block;
        cursor: pointer;
        @apply --layout-flex;
      }

      .container {
        text-align: center;
        width: 100%;
        position: relative;
        padding: 24px 0;

        @apply --exmg-paper-stepper-step;
      }

      .container:hover {
        background: var(--paper-grey-100);
      }

      paper-ripple {
        color: var(--primary-color);
      }

      .circleWrapper {
        @apply --layout-flex;
        @apply --layout;
        @apply --layout-center;
        width: 100%;
      }

      .circleWrapper::after, .circleWrapper::before {
        content: '';
        height: 1px;
        min-width: 16px;
        background: var(--paper-grey-400);
        @apply --layout-flex;
      }

      .circle {
        @apply --layout;
        @apply --layout-center;
        @apply --layout-center-justified;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        box-sizing: border-box;
        background: black;
        font-size: 12px;
        opacity: .38;
        color: white;
        margin: 0 8px;
        font-weight: 300;

        @apply --exmg-paper-stepper-circle;
      }

      .circle iron-icon {
        display: none;
      }

      :host([finished]) .circle {
        opacity: 1;
        background: var(--primary-color);
        color: white;

        @apply --exmg-paper-stepper-finished-circle;
      }

      :host([finished]) .circle > span {
        display: none;
      }

      :host([finished]) .circle iron-icon {
        width: 16px;
        height: 16px;
        display: block;
        fill: white;
      }

      :host([selected]) .circle {
        background: var(--primary-color);
        color: white;
        opacity: 1;

        @apply --exmg-paper-stepper-selected-circle;
      }

      .label {
        margin-top: 12px;
        color: black;
        opacity: .87;

        @apply --exmg-paper-stepper-label;
      }

      :host([selected]) .label {

        @apply --exmg-paper-stepper-selected-label;
      }

      :host(:first-of-type) .circleWrapper::before  {
        visibility: hidden;
      }

      :host(:last-of-type) .circleWrapper::after  {
        visibility: hidden;
      }

    </style>

    <div class="container" on-tap="_handleTap">
      <paper-ripple></paper-ripple>
      <div class="circleWrapper">
        <div class="circle">
          <iron-icon icon="exmg-paper-stepper-icons:check"></iron-icon>
          <span>[[index]]</span>
        </div>
      </div>
      <div class="label">[[label]]</label>

    </div>

  </template>

  <script>
    /**
     * `exmg-paper-stepper`
     *
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class ExmgPaperStep extends Polymer.GestureEventListeners(Polymer.Element) {
      static get is() { return 'exmg-paper-step'; }
      static get properties() {
        return {
          index: {
            type: Number,
          },
          label: {
            type: String,
            value: ''
          },
          selected: {
            type: Boolean,
            reflectToAttribute: true,
            value: false,
          },
          finished: {
            type: Boolean,
            reflectToAttribute: true,
            value: false,
          }
        };
      }
      setIndex(index) {
        this.set('index', index);
      }
      _handleTap(e) {
        this.select();
      }
      setFinished(finished) {
        if(this.finished !== finished) {
          this.set('finished', finished);
        }
      }
      deselect() {
        if(this.selected) {
          this.set('selected', false);
          this.dispatchEvent(new CustomEvent('deselected', { bubbles: true, composed: true, detail: { index: this.index } } ));
        }
      }
      select() {
        if(!this.selected) {
          this.set('selected', true);
          this.dispatchEvent(new CustomEvent('selected', { bubbles: true, composed: true, detail: { index: this.index } } ));
        }
      }
    }

    window.customElements.define(ExmgPaperStep.is, ExmgPaperStep);
  </script>
</dom-module>
